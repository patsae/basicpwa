# Cache

Cache à¸„à¸·à¸­à¸­à¸‡à¸„à¹Œà¸›à¸£à¸°à¸à¸­à¸šà¸ªà¸³à¸„à¸±à¸à¸—à¸µà¹ˆà¸—à¸³à¹ƒà¸«à¹‰ PWA à¸—à¸³à¸‡à¸²à¸™à¹„à¸”à¹‰à¸­à¸¢à¹ˆà¸²à¸‡à¸¡à¸µà¸›à¸£à¸°à¸ªà¸´à¸—à¸˜à¸´à¸ à¸²à¸ž à¹€à¸›à¸£à¸µà¸¢à¸šà¹€à¸ªà¸¡à¸·à¸­à¸™ 'à¸„à¸¥à¸±à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸³à¸£à¸­à¸‡' à¸—à¸µà¹ˆà¸„à¸­à¸¢à¸ˆà¸±à¸”à¹€à¸à¹‡à¸šà¸«à¸™à¹‰à¸²à¹€à¸§à¹‡à¸š à¹€à¸™à¸·à¹‰à¸­à¸«à¸² à¹à¸¥à¸°à¸£à¸¹à¸›à¸ à¸²à¸žà¸•à¹ˆà¸²à¸‡à¹† à¹„à¸§à¹‰à¹ƒà¸™à¸•à¸±à¸§à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡ à¹€à¸žà¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¹à¸­à¸›à¸žà¸¥à¸´à¹€à¸„à¸Šà¸±à¸™à¸¢à¸±à¸‡à¸„à¸‡à¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸£à¸µà¸¢à¸à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¹à¸¥à¸°à¹à¸ªà¸”à¸‡à¸œà¸¥à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸”à¹‰à¹à¸¡à¹‰à¹ƒà¸™à¸ªà¸ à¸²à¸§à¸°à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸¡à¸µà¸­à¸´à¸™à¹€à¸—à¸­à¸£à¹Œà¹€à¸™à¹‡à¸• (Offline)

à¹€à¸žà¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¸à¸²à¸£à¸ˆà¸±à¸”à¸à¸²à¸£à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸™à¸„à¸¥à¸±à¸‡à¸ªà¸³à¸£à¸­à¸‡à¸¡à¸µà¸›à¸£à¸°à¸ªà¸´à¸—à¸˜à¸´à¸ à¸²à¸žà¸ªà¸¹à¸‡à¸ªà¸¸à¸” à¸à¸²à¸£à¸—à¸³ Cache à¹ƒà¸™ PWA à¸ˆà¸¶à¸‡à¸¡à¸µà¸à¸¥à¸¢à¸¸à¸—à¸˜à¹Œà¸«à¸¥à¸±à¸à¸—à¸µà¹ˆà¸™à¸´à¸¢à¸¡à¹ƒà¸Šà¹‰ 3 à¸£à¸¹à¸›à¹à¸šà¸šà¸«à¸¥à¸±à¸à¹† à¹„à¸”à¹‰à¹à¸à¹ˆ Cache First, Network First à¹à¸¥à¸° Stale-While-Revalidate à¸‹à¸¶à¹ˆà¸‡à¹à¸•à¹ˆà¸¥à¸°à¸§à¸´à¸˜à¸µà¸ˆà¸°à¸–à¸¹à¸à¹€à¸¥à¸·à¸­à¸à¹ƒà¸Šà¹‰à¸•à¸²à¸¡à¸„à¸§à¸²à¸¡à¹€à¸«à¸¡à¸²à¸°à¸ªà¸¡à¸‚à¸­à¸‡à¸›à¸£à¸°à¹€à¸ à¸—à¸‚à¹‰à¸­à¸¡à¸¹à¸¥

# Cache Strategy

à¸„à¸·à¸­à¸à¸²à¸£à¸§à¸²à¸‡à¸à¸¥à¸¢à¸¸à¸—à¸˜à¹Œà¸§à¹ˆà¸² à¹€à¸¡à¸·à¹ˆà¸­à¸¡à¸µà¸à¸²à¸£à¹€à¸£à¸µà¸¢à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ (Request) à¹€à¸£à¸²à¸ˆà¸°à¹ƒà¸«à¹‰ Service Worker à¹„à¸›à¸«à¸¢à¸´à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸à¹„à¸«à¸™à¸¡à¸²à¹ƒà¸«à¹‰à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰ à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡ à¹€à¸„à¸£à¸·à¸­à¸‚à¹ˆà¸²à¸¢ (Network) à¸«à¸£à¸·à¸­ à¸«à¸™à¹ˆà¸§à¸¢à¸„à¸§à¸²à¸¡à¸ˆà¸³à¸ªà¸³à¸£à¸­à¸‡ (Cache)

1. Cache First (à¹€à¸™à¹‰à¸™à¹€à¸£à¹‡à¸§à¹€à¸›à¹‡à¸™à¸«à¸¥à¸±à¸)

à¸à¸¥à¸¢à¸¸à¸—à¸˜à¹Œà¸™à¸µà¹‰à¸ˆà¸°à¹„à¸›à¸”à¸¹à¹ƒà¸™ Cache à¸à¹ˆà¸­à¸™ à¸–à¹‰à¸²à¸¡à¸µà¸‚à¸­à¸‡à¹ƒà¸«à¹‰à¸ªà¹ˆà¸‡à¸„à¸·à¸™à¸—à¸±à¸™à¸—à¸µ à¹à¸•à¹ˆà¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µà¸„à¹ˆà¸­à¸¢à¸§à¸´à¹ˆà¸‡à¹„à¸›à¸”à¸¶à¸‡à¸ˆà¸²à¸à¹€à¸™à¹‡à¸•

    à¹€à¸«à¸¡à¸²à¸°à¸ªà¸³à¸«à¸£à¸±à¸š: à¹„à¸Ÿà¸¥à¹Œà¸—à¸µà¹ˆà¹à¸—à¸šà¹„à¸¡à¹ˆà¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹€à¸¥à¸¢ à¹€à¸Šà¹ˆà¸™ à¹„à¸­à¸„à¸­à¸™, à¸Ÿà¸­à¸™à¸•à¹Œ, à¸«à¸£à¸·à¸­à¸£à¸¹à¸›à¸ à¸²à¸žà¸žà¸·à¹‰à¸™à¸à¸²à¸™

    à¸‚à¹‰à¸­à¸”à¸µ: à¹€à¸§à¹‡à¸šà¹‚à¸«à¸¥à¸”à¹€à¸£à¹‡à¸§à¸¡à¸²à¸à¹à¸¥à¸°à¸¥à¸”à¸ à¸²à¸£à¸°à¹€à¸‹à¸´à¸£à¹Œà¸Ÿà¹€à¸§à¸­à¸£à¹Œ

2. Network First (à¹€à¸™à¹‰à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¥à¹ˆà¸²à¸ªà¸¸à¸”)

à¸žà¸¢à¸²à¸¢à¸²à¸¡à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸ Server à¸à¹ˆà¸­à¸™à¹€à¸ªà¸¡à¸­à¹€à¸žà¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¹„à¸”à¹‰à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸«à¸¡à¹ˆà¸—à¸µà¹ˆà¸ªà¸¸à¸” à¹à¸•à¹ˆà¸–à¹‰à¸²à¹€à¸™à¹‡à¸•à¸«à¸¥à¸¸à¸”à¸«à¸£à¸·à¸­à¹€à¸‚à¹‰à¸²à¹„à¸¡à¹ˆà¹„à¸”à¹‰ à¸„à¹ˆà¸­à¸¢à¹„à¸›à¸«à¸¢à¸´à¸šà¸ˆà¸²à¸ Cache à¸¡à¸²à¹ƒà¸Šà¹‰

    à¹€à¸«à¸¡à¸²à¸°à¸ªà¸³à¸«à¸£à¸±à¸š: à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹à¸›à¸¥à¸‡à¸šà¹ˆà¸­à¸¢ à¹€à¸Šà¹ˆà¸™ à¸£à¸²à¸„à¸²à¸ªà¸´à¸™à¸„à¹‰à¸², à¸£à¸²à¸¢à¸à¸²à¸£à¸‚à¹ˆà¸²à¸§, à¸«à¸£à¸·à¸­à¸«à¸™à¹‰à¸² Dashboard

    à¸‚à¹‰à¸­à¸”à¸µ: à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¹€à¸«à¹‡à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¥à¹ˆà¸²à¸ªà¸¸à¸”à¹€à¸ªà¸¡à¸­à¸–à¹‰à¸²à¸¡à¸µà¹€à¸™à¹‡à¸•

3. Stale-While-Revalidate (à¹€à¸£à¹‡à¸§à¸”à¹‰à¸§à¸¢à¹à¸¥à¸°à¹ƒà¸«à¸¡à¹ˆà¸”à¹‰à¸§à¸¢)

à¹€à¸›à¹‡à¸™à¸à¸¥à¸¢à¸¸à¸—à¸˜à¹Œà¸¢à¸­à¸”à¸™à¸´à¸¢à¸¡! à¸„à¸·à¸­à¸à¸²à¸£à¸ªà¹ˆà¸‡à¸‚à¸­à¸‡à¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆà¹ƒà¸™ Cache à¹ƒà¸«à¹‰à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¹„à¸›à¸à¹ˆà¸­à¸™à¸—à¸±à¸™à¸—à¸µ (à¹€à¸žà¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¹€à¸§à¹‡à¸šà¹€à¸›à¸´à¸”à¹„à¸§) à¹à¸•à¹ˆà¹ƒà¸™à¸‚à¸“à¸°à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™ Service Worker à¸ˆà¸°à¹à¸­à¸šà¹„à¸›à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸«à¸¡à¹ˆà¸ˆà¸²à¸ Server à¹à¸¥à¹‰à¸§à¸„à¹ˆà¸­à¸¢à¸›à¸£à¸±à¸šà¸›à¸£à¸¸à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸™à¸«à¸™à¹‰à¸²à¹€à¸§à¹‡à¸šà¸—à¸µà¸«à¸¥à¸±à¸‡ à¸žà¸£à¹‰à¸­à¸¡à¸à¸±à¸šà¸­à¸±à¸›à¹€à¸”à¸•à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸«à¸¡à¹ˆà¸¥à¸‡ Cache à¹„à¸§à¹‰à¸£à¸­à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸²à¸£à¹€à¸›à¸´à¸”à¸„à¸£à¸±à¹‰à¸‡à¸«à¸™à¹‰à¸²

    à¹€à¸«à¸¡à¸²à¸°à¸ªà¸³à¸«à¸£à¸±à¸š: à¸«à¸™à¹‰à¸²à¹‚à¸›à¸£à¹„à¸Ÿà¸¥à¹Œà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰ à¸«à¸£à¸·à¸­à¸šà¸—à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¸­à¸±à¸›à¹€à¸”à¸•à¹„à¸¡à¹ˆà¸šà¹ˆà¸­à¸¢à¸¡à¸²à¸

    à¸‚à¹‰à¸­à¸”à¸µ: à¹€à¸£à¹‡à¸§à¹€à¸—à¹ˆà¸² Cache First à¹à¸•à¹ˆà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸°à¹„à¸¡à¹ˆà¹€à¸à¹ˆà¸²à¸ˆà¸™à¹€à¸à¸´à¸™à¹„à¸›

| Cache Strategy         |   à¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§    | à¸„à¸§à¸²à¸¡à¸ªà¸”à¹ƒà¸«à¸¡à¹ˆà¸‚à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ |     à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸­à¸­à¸Ÿà¹„à¸¥à¸™à¹Œ      |
| :--------------------- | :-----------: | :-----------------: | :--------------------: |
| Cache First            | ðŸš€ à¹€à¸£à¹‡à¸§à¸—à¸µà¹ˆà¸ªà¸¸à¸” |    âš ï¸ à¸­à¸²à¸ˆà¸ˆà¸°à¹€à¸à¹ˆà¸²     |         âœ… à¹„à¸”à¹‰         |
| Network First          |  ðŸ¢ à¸Šà¹‰à¸²à¸à¸§à¹ˆà¸²   |    âœ¨ à¹ƒà¸«à¸¡à¹ˆà¸¥à¹ˆà¸²à¸ªà¸¸à¸”    | âœ… à¹„à¸”à¹‰ (à¸–à¹‰à¸²à¹€à¸„à¸¢à¹€à¸à¹‡à¸šà¹„à¸§à¹‰) |
| Stale-While-Revalidate |  ðŸš€ à¹€à¸£à¹‡à¸§à¸¡à¸²à¸   | ðŸ”„ à¹ƒà¸«à¸¡à¹ˆà¹ƒà¸™à¸„à¸£à¸±à¹‰à¸‡à¸–à¸±à¸”à¹„à¸› |         âœ… à¹„à¸”à¹‰         |

# Workshop

## 1. Cache First

à¹ƒà¸«à¹‰à¸—à¸³à¸à¸²à¸£à¸ªà¸£à¹‰à¸²à¸‡à¸«à¸™à¹‰à¸²à¹€à¸žà¸ˆà¹€à¸žà¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡ à¸„à¸·à¸­ about-us.html à¸à¸±à¸šà¸«à¸™à¹‰à¸² contact-us.html à¹à¸¥à¸°à¸«à¸™à¹‰à¸² offline.html à¸ªà¸³à¸«à¸£à¸±à¸šà¹€à¸›à¹‡à¸™ fallback page à¹ƒà¸™à¸à¸£à¸“à¸µà¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸žà¸šà¸¥à¸´à¹‰à¸‡à¸„à¹Œ à¹à¸¥à¹‰à¸§à¸—à¸³à¸à¸²à¸£à¹€à¸à¹‡à¸šà¸«à¸™à¹‰à¸²à¹€à¸žà¸ˆà¹€à¸«à¸¥à¹ˆà¸²à¸™à¸µà¹‰à¸¥à¸‡ cache storage à¹à¸¥à¹‰à¸§à¹€à¸£à¸µà¸¢à¸à¹ƒà¸Šà¹‰à¸­à¸­à¸à¸¡à¸²à¹à¸ªà¸”à¸‡

1.1. à¹€à¸£à¸²à¸ˆà¸°à¹€à¸à¹‡à¸šà¸«à¸™à¹‰à¸²à¹€à¸žà¸ˆ + CDN à¸¥à¸‡à¹ƒà¸™ Cache storage à¹ƒà¸«à¹‰à¹€à¸žà¸´à¹ˆà¸¡à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¹ƒà¸™ sw.js à¹ƒà¸«à¹‰à¹€à¸à¹‡à¸š cache à¸—à¸±à¹‰à¸‡ 3 à¸«à¸™à¹‰à¸²

```
//sw.js
const PRECACHE_URLS = [
  ...,
  "offline.html",
  "about-us.html",
  "contact-us.html",
];

```

1.2. à¹€à¸žà¸´à¹ˆà¸¡à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¹ƒà¸™ fetch event à¹ƒà¸«à¹‰à¹„à¸›à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸ Cache Storage à¸¡à¸²à¹ƒà¸Šà¹‰à¸‡à¸²à¸™

```
//sw.js

//Fetch Event
self.addEventListener("fetch", async (event) => {
  const req = event.request;

  //à¹€à¸¡à¸·à¹ˆà¸­à¸¡à¸µ Request à¹€à¸‚à¹‰à¸²à¸¡à¸²à¸ˆà¸°à¹„à¸›à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸ Cache storage à¸¡à¸²à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸à¹ˆà¸­à¸™
  if (req.mode === "navigate") {
    console.log("Handling navigation request for", req);
    event.respondWith(
      (async () => {
        const cached = await caches.match(req);
        if (cached) return cached;

        //fallback page
        return caches.match("/offline.html");
      })(),
    );
    return;
  }

  // Static assets: cache-first
  event.respondWith(
    (async () => {
      const cached = await caches.match(req);
      if (cached) return cached;

      try {
        const fresh = await fetch(req);
        // à¹€à¸à¹‡à¸šà¹€à¸‰à¸žà¸²à¸° response à¸—à¸µà¹ˆà¸›à¸à¸•à¸´
        const cache = await caches.open(CACHE_NAME);
        cache.put(req, fresh.clone());
        return fresh;
      } catch (e) {
        // à¸–à¹‰à¸²à¹€à¸›à¹‡à¸™ resource à¸­à¸·à¹ˆà¸™ à¹† à¹à¸¥à¹‰à¸§ offline à¸ˆà¸£à¸´à¸‡ à¹† à¸à¹‡à¸›à¸¥à¹ˆà¸­à¸¢à¹„à¸›
        return cached;
      }
    })(),
  );
});

```

1.3. à¸—à¸”à¸¥à¸­à¸‡à¹€à¸›à¸´à¸”à¹€à¸§à¹‡à¸šà¹„à¸‹à¸•à¹Œà¹à¸¥à¹‰à¸§à¹€à¸‚à¹‰à¸²à¹‚à¸«à¸¡à¸” offline à¸—à¸”à¸¥à¸­à¸‡à¹€à¸‚à¹‰à¸²à¸«à¸™à¹‰à¸²à¹€à¸žà¸ˆà¹à¸•à¹ˆà¸¥à¸°à¸«à¸™à¹‰à¸²

## 2. Network First

à¹€à¸£à¸²à¸ˆà¸°à¹€à¸žà¸´à¹ˆà¸¡à¸«à¸™à¹‰à¸² inventories.html à¸ªà¸³à¸«à¸£à¸±à¸šà¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸žà¸±à¸ªà¸”à¸¸à¸ˆà¸²à¸ api à¹à¸¥à¹‰à¸§à¸ˆà¸°à¸—à¸³à¸à¸²à¸£ cache à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸”à¹‰à¸§à¸¢à¸§à¸´à¸˜à¸µ Network first à¹ƒà¸«à¹‰à¸žà¸¢à¸²à¸¢à¸²à¸¡à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¥à¹ˆà¸²à¸ªà¸¸à¸”à¸ˆà¸²à¸ Server à¸à¹ˆà¸­à¸™à¹€à¸ªà¸¡à¸­ à¸«à¸²à¸à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸ªà¸³à¹€à¸£à¹‡à¸ˆà¸ˆà¸°à¸—à¸³à¸à¸²à¸£à¸­à¸±à¸›à¹€à¸”à¸•à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¥à¸‡ Cache à¹à¸•à¹ˆà¸«à¸²à¸à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¹„à¸¡à¹ˆà¹„à¸”à¹‰ (Offline) à¸ˆà¸¶à¸‡à¸ˆà¸°à¸ªà¸¥à¸±à¸šà¹„à¸›à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸³à¸£à¸­à¸‡à¸ˆà¸²à¸ Cache à¸¡à¸²à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¹à¸—à¸™

2.1. à¸—à¸³à¸à¸²à¸£ cahce à¸«à¸™à¹‰à¸²à¹€à¸§à¹‡à¸š inventories.html

```

const PRECACHE_URLS = [
  ...,
  "inventories.html",
];

```

2.2. à¹ƒà¸«à¹‰à¸«à¸™à¹‰à¸² inventories à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸£à¸²à¸¢à¸à¸²à¸£à¸ªà¸´à¸™à¸„à¹‰à¸²à¸ˆà¸²à¸ api

> https://dummyjson.com/products?limit=20&select=id,title,description,price,stock,thumbnail

2.3. à¸—à¸³à¸à¸²à¸£ cahce à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸ api à¸¥à¸‡à¹ƒà¸™ fetch event à¸”à¹‰à¸§à¸¢à¸§à¸´à¸˜à¸µ Network first

```

//sw.js

//Fetch Event
self.addEventListener("fetch", async (event) => {
  const req = event.request;

  // âœ… Network-First à¹€à¸‰à¸žà¸²à¸° GET url à¸—à¸µà¹ˆ /dummyjson.com à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™ url
  if (req.method === "GET" && req.url.includes("/dummyjson.com")) {
    event.respondWith(networkFirst(req));
    return;
  }

  // Static assets: cache-first
  if (req.mode === "navigate") {
  console.log("Handling navigation request for", req);
  event.respondWith(
  (async () => {
    const cached = await caches.match(req);
    if (cached) return cached;

      //fallback page
      return caches.match("/offline.html");
    })(),
  );
  return;
  }

  ...
});

//function à¹ƒà¸™à¸à¸²à¸£à¸—à¸³ Network first
async function networkFirst(req) {
  const cache = await caches.open(CACHE_NAME);

  try {
    // 1) à¸žà¸¢à¸²à¸¢à¸²à¸¡à¹€à¸­à¸²à¸ˆà¸²à¸ network à¸à¹ˆà¸­à¸™
    const fresh = await fetch(req);

    // 2) à¸–à¹‰à¸²à¹„à¸”à¹‰ 200 à¹€à¸à¹‡à¸šà¸¥à¸‡ cache à¹„à¸§à¹‰à¹ƒà¸Šà¹‰à¸•à¸­à¸™ offline
    if (fresh && fresh.ok) {
      cache.put(req, fresh.clone());
    }

    return fresh;
  } catch (e) {
    // 3) à¸–à¹‰à¸² network à¸žà¸±à¸‡ â†’ à¹€à¸­à¸²à¸ˆà¸²à¸ cache
    const cached = await cache.match(req);
    if (cached) return cached;

    // 4) à¹„à¸¡à¹ˆà¸¡à¸µ cache à¹€à¸¥à¸¢ â†’ à¸ªà¹ˆà¸‡ error response à¹à¸šà¸šà¸‡à¹ˆà¸²à¸¢
    return new Response(JSON.stringify([]), {
      headers: { "Content-Type": "application/json" },
      status: 200,
    });
  }
}

```

2.4. à¸—à¸”à¸¥à¸­à¸‡à¹€à¸›à¸´à¸”à¹€à¸§à¹‡à¸šà¹„à¸‹à¸•à¹Œà¹à¸¥à¹‰à¸§à¹€à¸‚à¹‰à¸²à¹‚à¸«à¸¡à¸” offline à¹à¸¥à¹‰à¸§à¸à¸”à¸›à¸¸à¹ˆà¸¡ _"à¸£à¸µà¹‚à¸«à¸¥à¸”"_ à¸”à¸¹à¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œà¸§à¹ˆà¸²à¸ªà¸²à¸¡à¸²à¸£à¸–à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ api à¸ˆà¸²à¸ cahce à¹„à¸”à¹‰à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ

## 3. Stale-While-Revalidate

3.1. à¹ƒà¸«à¹‰à¹€à¸žà¸´à¹ˆà¸¡à¸«à¸™à¹‰à¸² user.html à¹€à¸žà¸·à¹ˆà¸­à¹à¸ªà¸”à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸‡à¸²à¸™ à¹à¸¥à¸°à¸—à¸³à¸à¸²à¸£ cahce à¸«à¸™à¹‰à¸²à¹€à¸žà¸ˆà¹„à¸§à¹‰

```

const PRECACHE_URLS = [
  ...,
  "user.html",
];

```

3.2. à¸—à¸³à¸à¸²à¸£à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¡à¸²à¸ˆà¸²à¸ api à¸¡à¸²à¹à¸ªà¸”à¸‡à¹ƒà¸™à¸«à¸™à¹‰à¸² user.html

> https://randomuser.me/api

3.3. à¸—à¸³à¸à¸²à¸£à¹€à¸žà¸´à¹ˆà¸¡ script à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸²à¸£à¸£à¸±à¸š message "USER_API_UPDATED" à¹€à¸žà¸·à¹ˆà¸­à¹ƒà¸«à¹‰ browser à¸£à¸¹à¹‰à¸§à¹ˆà¸²à¸¡à¸µà¸à¸²à¸£à¸›à¸£à¸±à¸šà¸›à¸£à¸¸à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸«à¸¡à¹ˆ

```

// à¸à¸±à¸™ reload à¸‹à¹‰à¸³à¹†
let reloading = false;

if (navigator.serviceWorker) {
    navigator.serviceWorker.addEventListener("message", async (event) => {
        console.log(event.data?.type)
        if (event.data?.type === "USER_API_UPDATED") {
            if (reloading) return;
            reloading = true;

            // âœ… Re-render with new data immediately
            if (event.data?.data) {
                const api = JSON.parse(event.data.data);
                render(api.results[0]);
            } else {
                // Fallback: re-fetch
                await load();
            }

            setTimeout(() => reloading = false, 1000);
        }
    });
}

```

3.4. à¸—à¸³à¸à¸²à¸£à¹€à¸žà¸´à¹ˆà¸¡ script à¹ƒà¸™à¹„à¸Ÿà¸¥à¹Œ sw.js à¹€à¸£à¸²à¸ˆà¸°à¸—à¸³à¸à¸²à¸£à¹€à¸žà¸´à¹ˆà¸¡ function à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸²à¸£à¸—à¸³ Stale-While-Revalidate à¹à¸¥à¹‰à¸§à¹€à¸£à¸µà¸¢à¸à¹ƒà¸Šà¹‰à¹ƒà¸™ Fetch event

```

//sw.js

//Fetch Event
self.addEventListener("fetch", async (event) => {
  const req = event.request;

  //Network first
  ...

  //Stale-While-Revalidate
  if (req.method === "GET" && req.url.includes("/api/v1/user")) {
    event.respondWith(staleWhileRevalidate(req));
    return;
  }

  // Static assets: cache-first
  ...
});

async function networkFirst(req) {
  ...
}

//function à¸à¸²à¸£à¸—à¸³ Stale-While-Revalidate
async function staleWhileRevalidate(req) {
  const cache = await caches.open(CACHE_NAME);
  console.log("[staleWhileRevalidate] for Request", req.url);
  const cached = await cache.match(req.url, { ignoreVary: true });
  console.log("[staleWhileRevalidate] for Cache", cached);

  // âœ… Background update - always fetch to revalidate
  const networkPromise = fetch(req)
    .then(async (fresh) => {
      if (fresh && fresh.ok) {
        const old = await cache.match(req.url, { ignoreVary: true });

        // à¹€à¸›à¸£à¸µà¸¢à¸šà¹€à¸—à¸µà¸¢à¸š response à¹€à¸žà¸·à¹ˆà¸­à¸”à¸¹à¸§à¹ˆà¸²à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ
        const oldText = old ? await old.text() : null;
        const freshClone = fresh.clone();
        const freshText = await freshClone.text();
        const changed = oldText !== freshText;

        // à¸šà¸±à¸™à¸—à¸¶à¸ cache à¹ƒà¸«à¸¡à¹ˆ
        await cache.put(req, fresh.clone());

        // à¸ªà¹ˆà¸‡ message à¸–à¹‰à¸²à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™
        if (changed) {
          const clients = await self.clients.matchAll();
          for (const client of clients) {
            client.postMessage({
              type: "USER_API_UPDATED",
              data: freshText,
            });
          }
        }
      }
      return fresh;
    })
    .catch(() => null);

  // à¸–à¹‰à¸²à¸¡à¸µ cache à¸„à¸·à¸™à¸—à¸±à¸™à¸—à¸µ + background update
  if (cached) {
    console.log("à¸‰à¸±à¸™à¸¡à¸µ USER Cache");
    return cached;
  }

  // à¹„à¸¡à¹ˆà¸¡à¸µ cache à¸£à¸­ network
  return (
    (await networkPromise) ??
    new Response(JSON.stringify([]), {
      headers: { "Content-Type": "application/json" },
    })
  );
}

```
